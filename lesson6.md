


# Віконні функції в SQL: RANK, DENSE_RANK та ROW_NUMBER

## Вступ до віконних функцій

Віконні функції в SQL дозволяють виконувати обчислення над набором рядків, який пов'язаний із поточним рядком. У цій лекції ми розглянемо три важливі віконні функції: RANK, DENSE_RANK та ROW_NUMBER.

## Підготовка даних

Для наших прикладів використаємо таблицю `students`. Ви можете знайти код для створення цієї таблиці в ресурсах до лекції.

Спочатку переглянемо дані:

```sql
SELECT * FROM students;
```

## Функція ROW_NUMBER()

Функція ROW_NUMBER() присвоює унікальний порядковий номер кожному рядку в результаті запиту.

```sql
SELECT *,
    ROW_NUMBER() OVER (ORDER BY marks DESC) AS [Row Number]
FROM students;
```

**Особливості ROW_NUMBER():**
- Завжди присвоює унікальний номер кожному рядку
- У випадку однакових значень (наприклад, однакові оцінки) номери присвоюються випадковим чином
- Номери йдуть послідовно без пропусків (1, 2, 3, 4, ...)

## Функція RANK()

Функція RANK() присвоює ранг кожному рядку в результаті запиту.

```sql
SELECT *,
    RANK() OVER (ORDER BY marks DESC) AS [Rank Function]
FROM students;
```

**Особливості RANK():**
- Рядки з однаковими значеннями отримують однаковий ранг
- Якщо є кілька рядків з однаковим рангом, наступний ранг пропускається
- Наприклад: 1, 1, 3, 4, 4, 4, 7, ...

## Функція DENSE_RANK()

Функція DENSE_RANK() також присвоює ранг кожному рядку, але без пропусків.

```sql
SELECT *,
    DENSE_RANK() OVER (ORDER BY marks DESC) AS [Dense Rank]
FROM students;
```

**Особливості DENSE_RANK():**
- Рядки з однаковими значеннями отримують однаковий ранг
- Наступний ранг не пропускається, навіть якщо попередній ранг був присвоєний кільком рядкам
- Наприклад: 1, 1, 2, 3, 3, 3, 4, ...

## Порівняння функцій

### Ключові відмінності:

1. **ROW_NUMBER()**:
   - Завжди унікальний для кожного рядка
   - При однакових значеннях присвоюється випадково

2. **RANK()**:
   - Однакові значення отримують однаковий ранг
   - Пропускає наступні ранги при рівності

3. **DENSE_RANK()**:
   - Однакові значення отримують однаковий ранг
   - Не пропускає ранги

## Сортування за зростанням

Ми також можемо використовувати ці функції для сортування значень за зростанням:

```sql
SELECT *,
    ROW_NUMBER() OVER (ORDER BY marks) AS [Row Number],
    RANK() OVER (ORDER BY marks) AS [Rank Function],
    DENSE_RANK() OVER (ORDER BY marks) AS [Dense Rank]
FROM students;
```

У цьому випадку:
- Найнижчі оцінки отримають найнижчі ранги (1, 2, 3...)
- Найвищі оцінки отримають найвищі ранги

Зверніть увагу, що ключове слово ASC (ascending) є необов'язковим, оскільки сортування за зростанням використовується за замовчуванням.

## Висновок

Віконні функції RANK, DENSE_RANK та ROW_NUMBER є потужними інструментами для аналізу даних в SQL. Вони часто використовуються в аналітичних запитах та є популярними питаннями на співбесідах. У наступній лекції ми розглянемо використання цих функцій разом із конструкцією PARTITION BY для ще більш складного аналізу даних.
